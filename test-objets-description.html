<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test √©dition description page objets</title>
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/utilities.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/editor.css">
</head>
<body>
    <div class="container">
        <h1>Test √©dition description page objets</h1>
        <button id="devToggle">üõ† Dev Mode: ON</button>
        
        <!-- Simulation de la page objets avec description -->
        <article data-page-title="objets">
            <header>
                <h2>Objets</h2>
                <div class="editable-section" data-section-type="objet-category-description">
                    <div class="editable" data-edit-type="generic" data-edit-section="description">
                        √âquipements, armes, armures et objets divers que peuvent poss√©der les personnages.
                    </div>
                    <button class="btn edit-btn" style="display: inline-block;">‚úèÔ∏è</button>
                </div>
            </header>
        </article>
        
        <!-- Section pour les logs -->
        <div id="logs" style="margin-top: 20px; padding: 10px; background: #f0f0f0; border-radius: 6px;">
            <h3>Logs du test</h3>
            <div id="log-content"></div>
        </div>
        
        <!-- Bouton pour tester la sauvegarde -->
        <button id="testSave" style="margin-top: 10px; padding: 10px; background: #059669; color: white; border: none; border-radius: 6px;">
            üíæ Test Save/Export
        </button>
    </div>

    <!-- Chargement des modules dans l'ordre correct -->
    <script src="js/core.js"></script>
    <script src="js/config/contentTypes.js"></script>
    <script src="js/core/EventBus.js"></script>
    <script src="js/core/BaseEntity.js"></script>
    <script src="js/factories/ContentFactory.js"></script>
    <script src="js/builders/CardBuilder.js"></script>
    <script src="js/builders/PageBuilder.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/modules/images.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/router.js"></script>
    <script src="js/renderer.js"></script>
    <script src="js/core/UnifiedEditor.js"></script>
    <script src="js/editor.js"></script>
    <script src="js/ui.js"></script>
    
    <script>
        // Donn√©es de test
        window.OBJETS = {
            objets: [
                {
                    nom: "√âp√©e test",
                    numero: 1,
                    description: "Une √©p√©e de test",
                    tags: ["Arme"],
                    effet: "Fait des d√©g√¢ts",
                    prix: "10",
                    poids: "1"
                }
            ],
            categoryDescription: "√âquipements, armes, armures et objets divers que peuvent poss√©der les personnages.",
            description: "Fortune + d20"
        };
        
        // Logger pour suivre les changements
        function addLog(message) {
            const logContent = document.getElementById('log-content');
            const timestamp = new Date().toLocaleTimeString();
            logContent.innerHTML += `<div>[${timestamp}] ${message}</div>`;
        }
        
        // Initialiser l'application
        document.addEventListener('DOMContentLoaded', () => {
            try {
                JdrApp.init();
                addLog('‚úÖ Application initialis√©e');
                
                // Log initial des donn√©es
                addLog(`üìä Donn√©es initiales - categoryDescription: "${window.OBJETS.categoryDescription}"`);
                addLog(`üìä Donn√©es initiales - description: "${window.OBJETS.description}"`);
                
            } catch (error) {
                addLog(`‚ùå Erreur initialisation: ${error.message}`);
            }
        });
        
        // Test de sauvegarde
        document.getElementById('testSave').addEventListener('click', () => {
            addLog('üîç √âtat avant save:');
            addLog(`  - categoryDescription: "${window.OBJETS.categoryDescription}"`);
            addLog(`  - description: "${window.OBJETS.description}"`);
            
            // Simuler save/export
            if (JdrApp.modules.storage && JdrApp.modules.storage.saveChanges) {
                JdrApp.modules.storage.saveChanges();
                addLog('üíæ Sauvegarde effectu√©e');
                
                addLog('üîç √âtat apr√®s save:');
                addLog(`  - categoryDescription: "${window.OBJETS.categoryDescription}"`);
                addLog(`  - description: "${window.OBJETS.description}"`);
            } else {
                addLog('‚ùå Syst√®me de sauvegarde non disponible');
            }
        });
        
        // Observer les changements sur les donn√©es
        if (window.OBJETS && typeof Proxy !== 'undefined') {
            window.OBJETS = new Proxy(window.OBJETS, {
                set(target, property, value) {
                    addLog(`üîÑ Modification d√©tect√©e: ${property} = "${value}"`);
                    target[property] = value;
                    return true;
                }
            });
        }
    </script>
</body>
</html>