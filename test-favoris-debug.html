<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Test Debug Favoris</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
.card { border: 1px solid #ccc; padding: 20px; margin: 20px 0; position: relative; background: white; }
.favoris-star { 
  position: absolute; 
  top: 8px; 
  right: 8px; 
  background: rgba(0,0,0,0.1); 
  border: none; 
  border-radius: 50%; 
  width: 32px; 
  height: 32px; 
  cursor: pointer;
}
.favoris-star.favoris-active { background: rgba(255,215,0,0.2); color: #ffd700; }
.test-result { padding: 10px; margin: 10px 0; border-radius: 5px; }
.success { background: #d4edda; color: #155724; }
.error { background: #f8d7da; color: #721c24; }
</style>
</head>
<body>
<h1>üîç Test Debug - Boutons Favoris</h1>
<div id="test-results"></div>

<!-- Test de simulation d'une carte de sort -->
<div class="card spell-card" data-section-type="spell" data-spell-name="Boule de Feu">
  <div id="star-container"></div>
  <h3>Boule de Feu</h3>
  <p>Sort de feu qui inflige des d√©g√¢ts.</p>
</div>

<!-- Test de simulation d'une carte d'objet -->
<div class="card item-card" data-section-type="objet" data-objet-name="√âp√©e">
  <div id="star-container-objet"></div>
  <h3>√âp√©e Simple</h3>
  <p>Arme tranchante basique.</p>
</div>

<script>
// Simuler les constantes
window.STORAGE_KEYS = { FAVORIS: 'jdr-bab-favoris-test' };
window.Events = { 
  FAVORIS_ADD: 'favoris:add', 
  FAVORIS_REMOVE: 'favoris:remove', 
  FAVORIS_UPDATE: 'favoris:update' 
};

// Mock EventBus
window.EventBus = {
  events: {},
  emit(event, data) {
    console.log('EventBus emit:', event, data);
    if (this.events[event]) {
      this.events[event].forEach(callback => callback(data));
    }
  },
  on(event, callback) {
    if (!this.events[event]) this.events[event] = [];
    this.events[event].push(callback);
  }
};

// Test les r√©sultats
function addResult(message, type = 'info') {
  const div = document.createElement('div');
  div.className = `test-result ${type}`;
  div.textContent = message;
  document.getElementById('test-results').appendChild(div);
}

// Nettoyer le localStorage
localStorage.removeItem(window.STORAGE_KEYS.FAVORIS);

// Cr√©er une instance simplifi√©e du FavorisManager pour test
class TestFavorisManager {
  constructor() {
    this.favoris = { sorts: [], objets: [] };
  }
  
  isFavoris(type, nom) {
    return this.favoris[type] && this.favoris[type].includes(nom);
  }
  
  createStarButton(type, nom) {
    const isFav = this.isFavoris(type, nom);
    return `
      <button class="favoris-star ${isFav ? 'favoris-active' : ''}" 
              data-type="${type}" 
              data-nom="${nom}" 
              title="${isFav ? 'Retirer des favoris' : 'Ajouter aux favoris'}">
        ${isFav ? '‚≠ê' : '‚òÜ'}
      </button>
    `;
  }
  
  toggleFavoris(type, nom) {
    if (!this.favoris[type]) this.favoris[type] = [];
    const index = this.favoris[type].indexOf(nom);
    if (index > -1) {
      this.favoris[type].splice(index, 1);
      addResult(`‚ùå ${nom} retir√© des favoris ${type}`, 'info');
    } else {
      this.favoris[type].push(nom);
      addResult(`‚úÖ ${nom} ajout√© aux favoris ${type}`, 'success');
    }
    return true;
  }
}

// Cr√©er l'instance de test
window.FavorisManager = new TestFavorisManager();

// Test la cr√©ation de boutons
try {
  // Test pour sort
  const sortButton = window.FavorisManager.createStarButton('sorts', 'Boule de Feu');
  document.getElementById('star-container').innerHTML = sortButton;
  addResult('‚úÖ Bouton √©toile cr√©√© pour sort', 'success');
  
  // Test pour objet
  const objetButton = window.FavorisManager.createStarButton('objets', '√âp√©e');
  document.getElementById('star-container-objet').innerHTML = objetButton;
  addResult('‚úÖ Bouton √©toile cr√©√© pour objet', 'success');
  
} catch (error) {
  addResult(`‚ùå Erreur: ${error.message}`, 'error');
}

// Ajouter les event listeners
document.addEventListener('click', (event) => {
  const starBtn = event.target.closest('.favoris-star');
  if (starBtn) {
    event.preventDefault();
    const type = starBtn.dataset.type;
    const nom = starBtn.dataset.nom;
    
    window.FavorisManager.toggleFavoris(type, nom);
    
    // Recr√©er le bouton avec le nouveau statut
    const newButton = window.FavorisManager.createStarButton(type, nom);
    starBtn.outerHTML = newButton;
  }
});

addResult('üéØ Test pr√™t - Cliquez sur les √©toiles pour tester !', 'info');
</script>
</body>
</html>